---

copyright:
  years: 2018, 2019
lastupdated: "2019-06-28"

keywords: fairness, monitoring, charts, de-biasing, bias, accuracy

subcollection: ai-openscale

---

{:shortdesc: .shortdesc}
{:external: target="_blank" .external}
{:tip: .tip}
{:important: .important}
{:note: .note}
{:pre: .pre}
{:codeblock: .codeblock}
{:download: .download}
{:screen: .screen}
{:javascript: .ph data-hd-programlang='javascript'}
{:java: .ph data-hd-programlang='java'}
{:python: .ph data-hd-programlang='python'}
{:swift: .ph data-hd-programlang='swift'}
{:faq: data-hd-content-type='faq'}

# 公平性、毎分平均リクエスト数、正解率のモニター
{: #it-ov}

個々のデプロイメントのモニタリング・データは、時系列グラフに表示されます。 グラフは、過去 7 日間の公平性、毎分平均リクエスト数、正解率を追跡します。
{: shortdesc}

## デプロイメントのデータの表示
{: #it-vdep}

ダッシュボードからデプロイメントを選択し、そのデプロイメントのモニタリング・データを確認します。 **「モデル ID」**フィールドや**「作成日 (Created date)」**フィールドなど、デプロイ済みモデルに関する情報が見出しに表示されます。

![時系列グラフ](images/insight-time-chart.png)

アルゴリズム・チェックは 1 時間おきにしか実行されないので、公平性とモデル性能をオンデマンドで評価するためのリンクも用意されています。**「スケジュール」**パネルから以下のリンクをクリックすると、データをすぐに評価できます。

![公平性の評価ボタン](images/wos-fairness-button.png)


![モデル性能の評価ボタン](images/wos-quality-button.png)

次に、グラフをクリックし、グラフ上のマーカーを動かし、特定の時間の統計を表示します。

![時系列グラフの詳細](images/wos-insight-time-detail.png)

- ***公平性***: 2 つの公平性特徴量 (Sex と Age) が、許容されるしきい値設定を満たしています。
- ***モデル性能***: 構成されたしきい値を超えていたため、**ROC 曲線下面積**指標に警告が表示されています。
- ***平均要求数/分***: **「スループット」**指標をクリックすると、1 分間に処理されたレコードの数が表示されます。このスループットは毎分計算され、グラフには 1 時間の平均値が報告されます。

## 特定の時間のデータの視覚化
{: #it-vdet}

特定の公平性統計の背景にある詳細な情報を調べるには、特定の時刻のグラフをクリックします。

モニター対象の特徴量における選択した時間のデータ・ポイントの視覚化が開きます。 前の例に続いて、「Age」特徴量を次の例で示します。

ページの上部に 3 つのフィルター (特徴量、日付、時間) があり、詳細を確認するために異なる特徴量や時刻を選択できることに注目してください。

![時系列グラフ](images/wos-insight-data-detail.png)

### グラフの解釈
{: #it-intp}

グラフからはさまざまな事柄が分かります。

- バイアスが発生している集団 (18 歳から 23 歳の顧客) を観察できます。 グラフは、この集団の予想結果の割合も示しています。

- グラフは、準拠集団の予想結果の割合 (70%) を示しています。 これは、すべての準拠集団に対する予想結果の平均です。

- このグラフはバイアスの存在を示しています。これは、準拠集団の予期される結果のパーセンテージに対する 18 歳から 23 歳の集団の予期される結果のパーセンテージの比率が、しきい値を超えているためです。 つまり、0.52/0.7 = 0.74 であり、しきい値 0.8 より小さい値となっています。

- グラフは、ペイロード・テーブルのデータにある属性の個別の各値 (バイアスを識別するために分析された値) について、参照値とモニター対象値の分布も示しています。 つまり、バイアス検出アルゴリズムがペイロード・テーブルの最後の 1790 件のレコードを分析した場合、それらのレコードのうち 120 件は顧客の年齢が 18 歳から 23 歳であり、その分布のうち `Approved` と `Denied` の結果が棒グラフで表示されます。 公平性属性の個別の値ごとに、ペイロード・データの分布が示されます (参照値も表示されます)。 この情報を使用して、モデルから受け取ったデータ量にバイアスを相関させることができます。

- グラフはさらに、年齢が 31 歳から 35 歳の集団が 91% の予想結果になっていることを示しています。 これは、バイアスのソースを意味しています。つまり、このグループのデータが結果をゆがませ、参照クラスにおける予想結果の割合の増加につながったことを意味します。 この情報を使用して、モデルを再度訓練する際にデータのどの部分がサンプル不足となる可能性があるかを特定できます。

- グラフで示される別の重要な事項は、手動ラベル付けのために識別されたデータが含まれるテーブルの名前です。 アルゴリズムがモデルでバイアスを検出する際は常に、人間が手動でラベル付けするために送信できるデータ・ポイントも特定します。 この手動でラベル付けされるデータを、元の訓練データとともに使用してモデルを再度訓練できます。 このリトレーニングされたモデルには、バイアスがない可能性が高くなります。 手動ラベリング・テーブルは、{{site.data.keyword.aios_short}} インスタンスに関連付けられたデータベースにあります。

## トランザクションの表示
{: #it-tra}

このオプションでは、**「トランザクションの表示」**ボタンをクリックすると、バイアスの原因となった個々のトランザクションを表示できます。

![トランザクションの表示](images/view_transactions.png)

デプロイメントがバイアス挙動を示すトランザクションがリストされます。 任意のトランザクション ID の**「説明」**リンクをクリックすると、「説明性」タブにそのトランザクションに関する詳細が示されます。 詳しくは、[説明性のモニター](/docs/services/ai-openscale?topic=ai-openscale-ie-ov)を参照してください。

選択した特徴量 (この例では「AGE」) および選択した期間 (この例では「September 15, 2018 1:00 PM」) のすべてのトランザクションを表示するには、**「すべてのトランザクション」**ビューを選択します。

![すべてのトランザクションのリスト](images/transaction_list1.png)

バイアスありの結果となったトランザクションのサブセットのみを表示するには、**「バイアスのあるトランザクション」**ビューを選択します。 バイアスのある各トランザクションは、類似しているがわずかに変更された (摂動された) トランザクションと比較されます。これにより、モニター対象の特徴量 (AGE) の値を変更することで、バイアスのあるトランザクションがどのように好ましい結果になるかが示されます。

![バイアスのあるトランザクションのリスト](images/transaction_list2.png)

## 実動モデルとバイアスが緩和されたモデル
{: #it-prdb}

これらの 2 つのタブを使用して、{{site.data.keyword.aios_short}} で作成されたバイアスが緩和されたモデルと実動モデルの間で切り替えることができます。 詳しくは、[バイアス緩和の処理の流れについて](/docs/services/ai-openscale?topic=ai-openscale-mf-monitor#mf-debias)を参照してください。

![実行時と訓練の切り替え](images/bias-debias.png)

**「バイアスが緩和されたモデル」**タブを選択すると、実動のモデルと比較した場合の、バイアスが排除されたモデルの変更点が表示されます。 この例では、モデルの公平性が 74% から 93% に増えた一方で、正解率はわずか 1% 下がっただけです。 グラフには、年齢が 18 歳から 23 歳のグループの改善された結果状況も反映されます。

![実行時と訓練の切り替え](images/insight-data-detail2.png)

### バイアス緩和のオプション
{: #it-dbo}

{{site.data.keyword.aios_short}} では 2 種類のバイアス緩和を使用します。受動的なものとアクティブなものです。 受動的なバイアス緩和では、バイアスが存在していたことがユーザーに知らされます。一方、アクティブなバイアス緩和では、リアルタイムでモデルを変更して、現行のアプリケーションにそのバイアスが渡らないようにします。

- *受動的なバイアス緩和* - 受動的なバイアス緩和は、OpenScale 自体が、自動で 1 時間おきに実行する処理です。 「受動的」というのは、ユーザー介入なしで実行されるからです。 {{site.data.keyword.aios_short}} は、バイアス検査の実行と同時に、モデルの動作を分析し、モデルがバイアス挙動を示すデータを特定して、データのバイアス緩和も実行します。

  {{site.data.keyword.aios_short}} は次に、特定の新しいデータ・ポイントでモデルがバイアス挙動を示す可能性が高いかどうかを予測するための機械学習モデルを構築します。 その後、{{site.data.keyword.aios_short}} はモデルで受け取ったデータを 1 時間ごとに分析し、モデルがバイアス挙動を示すと {{site.data.keyword.aios_short}} が判断したデータ・ポイントを検出します。 こうしたデータ・ポイントでは、公平性属性は少数派から多数派に摂動され、摂動されたデータが元のモデルに送られて予測が行われます。 この元のモデルの予測がバイアス緩和出力として使用されます。

  {{site.data.keyword.aios_short}} はこのバイアス緩和を、過去 1 時間にモデルで受け取ったすべてのデータに対して 1 時間ごとに実行します。 また、バイアス緩和された出力の公平性を計算し、それを**「バイアスが緩和されたモデル」**タブに表示します。

- *アクティブなバイアス緩和* - アクティブなバイアス緩和とは、ユーザーが REST API エンドポイントを使用してバイアス緩和を要求し、バイアス緩和済みの結果をアプリケーションに返すことです。 バイアスのない状態でアプリケーションを実行できるように、ユーザーが積極的に {{site.data.keyword.aios_short}} にバイアス緩和の実行を指示し、モデルを変更します。 アクティブなバイアス緩和では、アプリケーションからバイアス緩和 REST API エンドポイントを利用できます。 この REST API エンドポイントは内部でモデルを呼び出し、その振る舞いを検査します。

  {{site.data.keyword.aios_short}} で、モデルがバイアスのある状態で動作していると検出された場合、前述のようにデータを摂動して、それが元のモデルに返送されます。 摂動されたデータに対する元のモデルの出力は、バイアス緩和した予測として返されます。 元のモデルがバイアス挙動を示していないと {{site.data.keyword.aios_short}} が判断すると、{{site.data.keyword.aios_short}} はバイアス緩和予測として元のモデルの予測を返します。 したがって、この REST API エンドポイントを使用することにより、アプリケーションがモデルのバイアス出力に基づいて決定を行うことを防止できます。

バイアス緩和 REST API エンドポイントを検出するには、**「バイアスが排除された予測エンドポイント」**リンクを選択します。

![バイアス緩和 API エンドポイント](images/insight-debias-api.png)
